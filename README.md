# Редактор ресурсов Luxms BI

## Описание
Проект создан для упрощения работы с ресурсами Luxms BI и для организации их хранения в репозитории.

Для каждого проекта создается своя ветка, которая будет хранить все ресурсные файлы, их историю и
скрипты для синхронизации

## Сценарий использования
Требования:
- Наличие админского имени пользователя и пароля для доступа к Luxms BI

1. Перейдите в ветку проекта
   ```
   git checkout <project_name>
   ```

2. Установите зависимости
   ```
   npm install
   ```

3. Запустите команду
   ```
   npm run pull
   ```
   которая скачает с сервера последнюю версию ресурсов (потребуются имя пользователя и пароль). Если ресурсы
   на сервере отличаются от локальных, будет выведен список изменений и ожидаться подтверждение перезаписи
   локальных файлов

4. Запустите проект
   ```
   npm start
   ```

5. Зайдите браузером по адресу http://localhost:3000 , там будет доступен сервер проекта, но файлы ресурсов
будут браться из папки `/src` проекта

6. Работайте над файлами в папке `/src` и проверяйте их работу в браузере.

7. По окончании закоммитьте код в git-репозиторий и выполните команду
   ```
   npm run push
   ```
   Для отправки изменений в ресурсы сервера. Потребуются имя пользователя и пароль. Команда выведет список
   измененных файлов и запросит подтверждение их отправки на сервер.


## Команды
Реализованы три команды
```
npm run pull
```
Все ресурсы с сервера будут скачены в папку `/src' проекта. Лишние локальные файлы будут удалены.

Команда запросит имя пользователя и пароль (если не указаны к конфиге), сравнит ресурсы сервера с
локальными файлами, напечатает список измененных файлов и запросит подтверждение.

```
npm run push
```
Заливает все локальные файлы на сервер. Отсутствующие локально файлы будут удалены на сервере.

Команда запросит имя пользователя и пароль (если не указаны в конфиге), сравнит локальные файлы с
серверными, напечатает список измененных файлов и запросит подтверждение.

```
npm start
```
Запускает на `http://localhost:3000` http сервер для разработки с настроенным проксированием на указанный
в конфиге сервер. Проксируются все файлы, кроме `/srv/resources` которые берутся из папки `/src`


## Конфигурация

Проект считывает конфигурацию последовательно из разных источников.

В конфигурацию входят:
- `server` - http адрес сервера, например `http://project.luxmsbi.com/`
- `username` - имя пользователя для доступа к серверу. Требуются админские права
- `password` - пароль для пользователя `username`

Если значения нигде не найдены, то их потребуется ввести с клавиатуры

Последовательно проверяются следующие источники конфигурации:

- Опции командной строки

    При запуске команды можно указать любые из `--server=...`, `--username=...` и `--password=...`. При этом
    их необходимо отделять от команды знаком `--`
    ```
    npm run push  -- --server=http://project.luxmsbi.com/ --username=admin --password=secret
    npm start  -- --server=http://project.luxmsbi.com/
    ```

- переменные окружения
    должны быть написаны заглавными буквами: `SERVER`, `USERNAME`, `PASSWORD`
    ```
    SERVER=http://project.luxmsbi.com/  npm start

    export USERNAME=admin
    export PASSWORD=secret
    npm run push
    ```

- Файлы конфигурации
    В корне проекта лежит файл `config.json`, который хранит значение конфигурации server
    ```
    {
        "server": "http://project.luxmsbi.com/"
    }
    ```
    Этот файл должен лежать в каждой ветке проекта и указывать корректный сервер

    Можно создать в корне проекта файл `authConfig.json` и в нем указать имя пользователя и пароль
    ```
    {
        "username": "admin",
        "password": "secret"
    }
    ```
    Этот файл занесен в `.gitignore` и не должен попасть в git.

- Ввод с клавиатуры
    Если значение не найдено ни одим из предыдущих способов, команды `npm start`, `npm run pull` и
    `npm run push` запросят их ввод с клавиатуры


### Примечания

Команда `npm start` не требует ввода имени пользователя и пароля, для работы ей требуется только server.

Однако, если перейти в браузере на `http://localhost:3000/#/ds/ds_xxx/resources` то в консоли может
запроситься имя пользователя и пароль (если не указаны каким либо другим образом).
Они необходимы для конвертации `resource.id` в имя файла.
